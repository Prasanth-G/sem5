CREATE TABLE PERSON(NAME VARCHAR(20) PRIMARY KEY,AGE INTEGER,GENDER VARCHAR(20) CHECK (GENDER = 'male' OR GENDER = 'female'));
INSERT INTO PERSON VALUES ('Amy', 16, 'female');
INSERT INTO PERSON VALUES ('Ben', 21, 'male');
INSERT INTO PERSON VALUES ('Cal', 33, 'male');
INSERT INTO PERSON VALUES ('Dan', 13, 'male');
INSERT INTO PERSON VALUES ('Eli', 45, 'male');
INSERT INTO PERSON VALUES ('Fay', 21, 'female');
INSERT INTO PERSON VALUES ('Gus', 24, 'male');
INSERT INTO PERSON VALUES ('Hil', 30, 'female');
INSERT INTO PERSON VALUES ('Ian', 18, 'male');

CREATE TABLE PIZZERIAS(PIZZERIA VARCHAR(20) PRIMARY KEY);
INSERT INTO PIZZERIAS VALUES ('Chicago Pizza');
INSERT INTO PIZZERIAS VALUES ('Dominos');
INSERT INTO PIZZERIAS VALUES ('Little Caesars');
INSERT INTO PIZZERIAS VALUES ('New York Pizza');
INSERT INTO PIZZERIAS VALUES ('Pizza Hut');
INSERT INTO PIZZERIAS VALUES ('Straw Hat');

CREATE TABLE FREQUENTS(NAME VARCHAR(10) REFERENCES PERSON(NAME), PIZZERIA VARCHAR(15), PRIMARY KEY(NAME, PIZZERIA));
INSERT INTO FREQUENTS VALUES ('Amy', 'Pizza Hut');
INSERT INTO FREQUENTS VALUES ('Ben', 'Chicago Pizza');
INSERT INTO FREQUENTS VALUES ('Ben', 'Pizza Hut');
INSERT INTO FREQUENTS VALUES ('Cal', 'New York Pizza');
INSERT INTO FREQUENTS VALUES ('Cal', 'Straw Hat');
INSERT INTO FREQUENTS VALUES ('Dan', 'New York Pizza');
INSERT INTO FREQUENTS VALUES ('Dan', 'Straw Hat');
INSERT INTO FREQUENTS VALUES ('Eli', 'Chicago Pizza');
INSERT INTO FREQUENTS VALUES ('Eli', 'Straw Hat');
INSERT INTO FREQUENTS VALUES ('Fay', 'Dominos');
INSERT INTO FREQUENTS VALUES ('Fay', 'Little Caesars');
INSERT INTO FREQUENTS VALUES ('Gus', 'Chicago Pizza');
INSERT INTO FREQUENTS VALUES ('Gus', 'Pizza Hut');
INSERT INTO FREQUENTS VALUES ('Hil', 'Dominos');
INSERT INTO FREQUENTS VALUES ('Hil', 'Pizza Hut');
INSERT INTO FREQUENTS VALUES ('Hil', 'Straw Hat');
INSERT INTO FREQUENTS VALUES ('Ian', 'Dominos');
INSERT INTO FREQUENTS VALUES ('Ian', 'New York Pizza');
INSERT INTO FREQUENTS VALUES ('Ian', 'Straw Hat');

CREATE TABLE EATS(NAME VARCHAR(10) REFERENCES PERSON(NAME), PIZZA VARCHAR(10), PRIMARY KEY(NAME, PIZZA));
INSERT INTO EATS VALUES ('Amy', 'mushroom');
INSERT INTO EATS VALUES ('Amy', 'pepperoni');
INSERT INTO EATS VALUES ('Ben', 'cheese');
INSERT INTO EATS VALUES ('Ben', 'pepperoni');
INSERT INTO EATS VALUES ('Cal', 'supreme');
INSERT INTO EATS VALUES ('Dan', 'cheese');
INSERT INTO EATS VALUES ('Dan', 'mushroom');
INSERT INTO EATS VALUES ('Dan', 'pepperoni');
INSERT INTO EATS VALUES ('Dan', 'sausage');
INSERT INTO EATS VALUES ('Dan', 'supreme');
INSERT INTO EATS VALUES ('Eli', 'cheese');
INSERT INTO EATS VALUES ('Eli', 'supreme');
INSERT INTO EATS VALUES ('Fay', 'mushroom');
INSERT INTO EATS VALUES ('Gus', 'cheese');
INSERT INTO EATS VALUES ('Gus', 'mushroom');
INSERT INTO EATS VALUES ('Gus', 'supreme');
INSERT INTO EATS VALUES ('Hil', 'cheese');
INSERT INTO EATS VALUES ('Hil', 'supreme');
INSERT INTO EATS VALUES ('Ian', 'pepperoni');
INSERT INTO EATS VALUES ('Ian', 'supreme');

CREATE TABLE PIZZAS AS (SELECT DISTINCT PIZZA FROM EATS);
ALTER TABLE PIZZAS ADD ( CONSTRAINT C1 PRIMARY KEY(PIZZA));
CREATE TABLE SERVES(PIZZERIA VARCHAR(10) REFERENCES PIZZERIAS(PIZZERIA), PIZZA VARCHAR(10) REFERENCES PIZZAS(PIZZA), PRICE INTEGER, PRIMARY KEY(PIZZERIA, PIZZA));

INSERT INTO SERVES VALUES ('Chicago Pizza', 'cheese', 7.75);
INSERT INTO SERVES VALUES ('Chicago Pizza', 'supreme', 8.5);
INSERT INTO SERVES VALUES ('Dominos', 'cheese', 9.75);
INSERT INTO SERVES VALUES ('Dominos', 'mushroom', 11);
INSERT INTO SERVES VALUES ('Little Caesars', 'cheese', 7);
INSERT INTO SERVES VALUES ('Little Caesars', 'mushroom', 9.25);
INSERT INTO SERVES VALUES ('Little Caesars', 'pepperoni', 9.75);
INSERT INTO SERVES VALUES ('Little Caesars', 'sausage', 9.5);
INSERT INTO SERVES VALUES ('New York Pizza', 'cheese', 7);
INSERT INTO SERVES VALUES ('New York Pizza', 'pepperoni', 8);
INSERT INTO SERVES VALUES ('New York Pizza', 'supreme', 8.5);
INSERT INTO SERVES VALUES ('Pizza Hut', 'cheese', 9);
INSERT INTO SERVES VALUES ('Pizza Hut', 'pepperoni', 12);
INSERT INTO SERVES VALUES ('Pizza Hut', 'sausage', 12);
INSERT INTO SERVES VALUES ('Pizza Hut', 'supreme', 12);
INSERT INTO SERVES VALUES ('Straw Hat', 'cheese', 9.25);
INSERT INTO SERVES VALUES ('Straw Hat', 'pepperoni', 8);
INSERT INTO SERVES VALUES ('Straw Hat', 'sausage', 9.75);

#1
DECLARE
	NAME_ PERSON.NAME%TYPE;
	AGE_ PERSON.AGE%TYPE;
	GENDER_ PERSON.GENDER%TYPE;
	CURSOR C IS
		SELECT NAME, AGE, GENDER FROM PERSON;
BEGIN
	OPEN C;
	LOOP
		FETCH C INTO NAME_, AGE_, GENDER_;
		EXIT WHEN C%NOTFOUND;
		DBMS_OUTPUT.PUT_LINE(NAME_ || ' ' || AGE_ || ' ' || GENDER_);
	END LOOP;
	CLOSE C;
END;

#2
DECLARE
	PIZZA_COUNT_ NUMBER;
	PIZZA_ EATS.PIZZA%TYPE;
	CURSOR C IS
		SELECT PIZZA, COUNT(PIZZA) AS PIZZA_COUNT FROM EATS GROUP BY PIZZA ORDER BY PIZZA_COUNT DESC;
	LOOP_VAR NUMBER := 0;
BEGIN
	OPEN C;
	LOOP
		FETCH C INTO PIZZA_, PIZZA_COUNT_;
		EXIT WHEN C%NOTFOUND OR LOOP_VAR > 2;
		LOOP_VAR := LOOP_VAR + 1;
		DBMS_OUTPUT.PUT_LINE(PIZZA_ || ' ' || PIZZA_COUNT_);
	END LOOP;
	CLOSE C;
END;

#3
DECLARE
BEGIN
	INSERT INTO PERSON VALUES ('TEST1', 21, 'male');
	INSERT INTO SERVES VALUES ('Straw Hat', 'cheese', 7.75);
END;






DROP TABLE SERVES;
DROP TABLE EATS;
DROP TABLE FREQUENTS;
DROP TABLE PERSON;


