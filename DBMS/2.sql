CREATE TABLE SUPPLIER(
SNO VARCHAR(2) PRIMARY KEY,
SNAME CHAR(20) NOT NULL,
STATUS NUMBER NOT NULL CHECK (STATUS <= 50 AND MOD(STATUS,10) = 0),
CITY CHAR(15)
);

CREATE TABLE PART(
PNO VARCHAR(2) PRIMARY KEY,
PNAME CHAR(10) NOT NULL,
COLOUR CHAR(10),
WEIGHT NUMBER NOT NULL,
CITY CHAR(15)
);

CREATE TABLE SHIPMENT(
SNO VARCHAR(2) NOT NULL REFERENCES SUPPLIER(SNO),
PNO VARCHAR(2) NOT NULL REFERENCES PART(PNO),
QTY NUMBER CHECK (QTY <= 1000),
PRICE NUMBER
);

INSERT INTO SUPPLIER1 VALUES('s1', 'Smith', 10, 'London');
INSERT INTO SUPPLIER VALUES('s2', 'Jones', 10, 'Paris');
INSERT INTO SUPPLIER VALUES('s3', 'Blake', 30, 'Paris');
INSERT INTO SUPPLIER VALUES('s4', 'Clark', 20, 'London');
INSERT INTO SUPPLIER VALUES('s5', 'Adams', 30, NULL);

INSERT INTO PART VALUES ('p1', 'Nut', 'Red', 12, 'London');
INSERT INTO PART VALUES ('p2', 'Bolt', 'Green', 17, 'Paris');
INSERT INTO PART VALUES ('p3', 'Screw', 'NULL', 17, 'Rome');
INSERT INTO PART VALUES ('p4', 'Screw', 'Red', 14, 'London');
INSERT INTO PART VALUES ('p5', 'Cam', 'Blue', 12, 'Paris');
INSERT INTO PART VALUES ('p6', 'Cog', 'Red', 19, 'London');

INSERT INTO SHIPMENT VALUES ('s1', 'p1', 300, .005);
INSERT INTO SHIPMENT VALUES ('s1', 'p2', 200, .009);
INSERT INTO SHIPMENT VALUES ('s1', 'p3', 400, .004);
INSERT INTO SHIPMENT VALUES ('s1', 'p4', 200, .009);
INSERT INTO SHIPMENT VALUES ('s1', 'p5', 100, .01);
INSERT INTO SHIPMENT VALUES ('s1', 'p6', 100, .01);
INSERT INTO SHIPMENT VALUES ('s2', 'p1', 300, .006);
INSERT INTO SHIPMENT VALUES ('s2', 'p2', 400, .004);
INSERT INTO SHIPMENT VALUES ('s3', 'p2', 200, .009);
INSERT INTO SHIPMENT VALUES ('s3', 'p3', 200, NULL);
INSERT INTO SHIPMENT VALUES ('s4', 'p2', 200, .008);
INSERT INTO SHIPMENT VALUES ('s4', 'p3', NULL, NULL);
INSERT INTO SHIPMENT VALUES ('s4', 'p4', 300, .006);
INSERT INTO SHIPMENT VALUES ('s4', 'p5', 400, .003);

SELECT SHIPMENT.PNO, PNAME FROM SHIPMENT, PART WHERE SHIPMENT.PNO = PART.PNO AND SHIPMENT.SNO = 's2';
SELECT DISTINCT F.PNO, F.PNAME, F.COLOUR, F.WEIGHT, F.CITY FROM PART F, PART S WHERE F.COLOUR = S.COLOUR AND F.PNO != S.PNO;
SELECT DISTINCT F.PNO, F.PNAME, F.COLOUR, F.WEIGHT, F.CITY FROM PART F, PART S WHERE F.CITY = S.CITY AND F.PNO != S.PNO;
##SELECT * FROM SHIPMENT WHERE PNO = ALL (SELECT PNO FROM PART)
SELECT * FROM SHIPMENT WHERE QTY BETWEEN 300 AND 750;
SELECT DISTINCT PNAME FROM PART WHERE PNO = ANY (SELECT DISTINCT PNO FROM SHIPMENT WHERE QTY BETWEEN 200 AND 750);
SELECT SNAME FROM SUPPLIER WHERE SNO = ANY(SELECT DISTINCT SNO FROM SHIPMENT WHERE PNO= 'p2' OR PNO = 'p4');
SELECT SNAME FROM SUPPLIER WHERE SNO = ANY(SELECT SNO FROM SHIPMENT WHERE PNO = ALL (SELECT PNO FROM SHIPMENT WHERE SNO = 's3') AND SNO != 's3');
SELECT DISTINCT SNO FROM SHIPMENT WHERE PNO = ANY(SELECT PNO FROM PART WHERE COLOUR = 'Red');
SELECT PNAME FROM PART WHERE PNO = ANY(SELECT PNO FROM (SELECT PNO, COUNT(SNO) FROM SHIPMENT GROUP BY PNO HAVING COUNT(SNO) > 2));	
SELECT SNO FROM SUPPLIER MINUS (SELECT DISTINCT SNO FROM SHIPMENT WHERE PNO = ANY(SELECT PNO FROM PART WHERE COLOUR = 'Red'));
SELECT DISTINCT SNO FROM SHIPMENT WHERE PNO = ANY(SELECT PNO FROM PART WHERE COLOUR = 'Red');
SELECT SNO FROM SUPPLIER MINUS SELECT DISTINCT SNO FROM SHIPMENT;
SELECT DISTINCT SNO FROM SHIPMENT WHERE PNO = ANY(SELECT PNO FROM SHIPMENT WHERE SNO = 's2') AND SNO != 's2';
##SELECT DISTINCT PART.PNO, PART.PNAME, SUM(SHIPMENT.QTY) FROM PART, SHIPMENT WHERE PART.PNO = ANY(SELECT PNO FROM SHIPMENT WHERE SNO = (SELECT SNO FROM SUPPLIER WHERE SNAME = 'Blake')) GROUP BY PART.PNO;
SELECT * FROM SHIPMENT WHERE PRICE IS NOT NULL ORDER BY PRICE DESC;
SELECT SNO FROM SUPPLIER WHERE CITY = (SELECT CITY FROM SUPPLIER WHERE SNO = 's1') AND SNO != 's1';
SELECT PNO, COUNT(SNO) FROM SHIPMENT GROUP BY PNO HAVING COUNT(SNO) > 1;
SELECT SNO FROM SUPPLIER WHERE STATUS < (SELECT AVG(STATUS) FROM SUPPLIER);
SELECT COUNT(*) FROM SUPPLIER;
SELECT COUNT(*) FROM (SELECT DISTINCT SNO FROM SHIPMENT);
SELECT SNO, MAX(PRICE) FROM SHIPMENT GROUP BY SNO;
##FIRST TWO SELECT SNO FROM SHIPMENT WHERE 
SELECT MAX(T.TQP) FROM (SELECT SNO AS TSNO, SUM(QTY * PRICE) AS TQP  FROM SHIPMENT GROUP BY SNO) T;
SELECT SNO, COUNT(PNO) FROM SHIPMENT GROUP BY SNO;
SELECT SNO, SNAME, STATUS FROM SUPPLIER WHERE SNO = ANY(SELECT DISTINCT SNO FROM SHIPMENT WHERE QTY > 250);
##SELECT PNO, SUM(QTY) FROM SHIPMENT GROUP BY PNO;
#SELECT * FROM (SELECT PNO AS FPNO, COUNT(PNO) AS CPNO FROM SHIPMENT GROUP BY PNO) S WHERE  S.CPNO = (SELECT MIN(T.PNO_COUNT) FROM (SELECT PNO AS TPNO, COUNT(PNO) AS PNO_COUNT FROM SHIPMENT GROUP BY PNO) T);
SELECT F.SNO, F.QP FROM (SELECT SNO, SUM(QTY * PRICE) AS QP FROM SHIPMENT GROUP BY SNO) F WHERE F.QP = (SELECT MAX(T.QP) FROM (SELECT SNO , SUM(QTY * PRICE) AS QP FROM SHIPMENT GROUP BY SNO) T);
CREATE VIEW PART_VIEW AS SELECT PART.PNO, PART.PNAME, PART.COLOUR, PART.WEIGHT, PART.CITY, T.TCOST, T.TQTY FROM PART, (SELECT PNO, SUM(PRICE) AS TCOST, SUM(QTY) AS TQTY FROM SHIPMENT GROUP BY PNO) T; 

(SELECT * FROM SHIPMENT) UNION CORRESPONDING BY (PNO) (SELECT PNO FROM SHIPMENT WHERE SNO = 's3');

SELECT * FROM SUPPLIER NATURAL JOIN SHIPMENT; 

#DROP TABLE SHIPMENT;
#DROP TABLE SUPPLIER;
#DROP TABLE PART;
#SELECT * FROM TAB;